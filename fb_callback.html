<!doctype html>
<html lang="en">
  <meta charset="utf-8" />
  <title>Facebook Callback</title>
  <script>
    (function () {
      console.log("fb_callback.html loaded");

      if (!window.opener) {
        console.error("No opener window found");
        return;
      }

      const params = new URLSearchParams(window.location.search);
      const targetOrigin = params.get("state"); // carries parentOrigin (http://localhost:49960)
      console.log("targetOrigin =", targetOrigin);

      if (!targetOrigin) {
        console.error("No targetOrigin found in state");
        return;
      }

      // Post the full URL (includes ?code=...)
      window.opener.postMessage(window.location.href, targetOrigin);

      console.log("Message posted to opener");
      // Optional: close after short delay
      setTimeout(() => window.close(), 100);
    })();
  </script>
</html>
